{% extends 'ej_conversations/base.jinja2' %}
{% set main_class = 'container-1 pad-x0' %}


{% block content %}
    <form method="POST" class="width-full">
        {{ csrf_input }}
        {% include 'ej_conversations/includes/editable-conversation-balloon.jinja2' %}

        {% block form_content %}
            <div class="measure margin-xauto">
                {# CONVERSATION FORM #}
                <h1 class="h2 text-accent text-center">{{ _('Conversation') }}</h1>
                <p class="text-center">{% trans %}Please fill the details bellow.{% endtrans %}</p>

                {{ form.non_field_errors() }}
                {{ form.title.errors }}
                <label>{{ form.title.label }}{{ form.title }}</label>
                <legend>{{ form.title.help_text }}</legend>


                {# ADD COMMENTS #}
                <h1 class="h2 text-accent text-center">{{ _('Initial comments') }}</h1>
                <p class="text-center">
                    {% trans %}Add as many comments as you like (including none).{% endtrans %}{{ ' ' }}
                    {% trans %}Remember to give a minimum context and something for other users to
                        explore.{% endtrans %}{{ ' ' }}
                    {% trans %}You can add as many comments as you want later.{% endtrans %}
                </p>
                <input type="hidden" name="comments_count" value="3">
                <div id="comment-list">
                    {% for i in range(1, 4) %}
                        <label>
                            {% trans %}Comment {{ i }}{% endtrans %}
                            <textarea name="comment-{{ i }}"
                                      placeholder="{{ _('Type your comment here') }} #{{ i }}"></textarea>
                        </label>
                    {% endfor %}
                </div>

                <a class="block uppercase text-center semi-bold" id="add-more-comments" tabindex="0">
                    <i class="fa fa-plus"></i> {{ _('Add more comments') }}
                </a>

                <div class="margin-xauto margin-y3 text-center">
                    <input class="is-primary" type="submit" value="{{ _('Create conversation') }}">
                </div>
            </div>
        {% endblock %}
    </form>
{% endblock %}


{% block javascript_body %}
    {{ super() }}
    <script defer>
        window.addEventListener('load', function () {
            $('#add-more-comments')
                .on('click keypress', function (ev) {
                    // keycodes: 13 = return; 32 = space
                    if (ev.type === "keypress" && (![13, 32].includes(ev.keyCode))) return;
                    console.log(ev.keyCode);
                    var $input = $('input[name="comments_count"]'),
                        index = parseInt($input.val(), 10) + 1,
                        template = (
                            '<label>' +
                            '{% trans %}Comment %i%{% endtrans %}' +
                            '<textarea name="comment-%i%" placeholder="{{ _('Type your comment here') }} #%i%"></textarea>' +
                            '</label>');
                    $input.val(index);
                    $('#comment-list').append(template.replace(/%i%/g, index));
                });
        });
    </script>
{% endblock %}
