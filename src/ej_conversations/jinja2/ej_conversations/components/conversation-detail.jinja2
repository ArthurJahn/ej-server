{% from 'ej_conversations/components/comment-detail.jinja2' import comment_detail, comment_form with context %}
{% from 'components/generic/react.jinja2' import react_component %}

{% macro conversation_detail(conversation, edit_perm, user, javascript_enabled='') %}

    <div class="ConversationDetail">
        {{ react_component('conversation', conversation_detail_static(conversation, edit_perm, user), javascript_enabled, '{"slug":"' + conversation.slug + '"}') }}
    </div>

{% endmacro %}

{% macro conversation_detail_static(conversation, edit_perm, user) %}
    {% if edit_perm %}
        <div class="Container" style="margin: 0 auto; padding: 0">
            {{ action_button( _('Edit Conversation'), conversation.get_absolute_url() + 'edit/') }}
        </div>
    {% endif %}
    <div class="ConversationDetail">
        <div class="ConversationDetail-banner">
            <h1>{{ conversation.text }}</h1>
            <ul class="ConversationDetail-statistics">
                <li>{{ gettext('%(count)s comments', count=conversation.comments.count()) }}</li>
                <li>{{ gettext('%(count)s votes', count=conversation.votes.count()) }}</li>
            </ul>
        </div>

        <div class="ConversationDetail-arrow"></div>

        {# Current comment #}
        <div class="ConversationDetail-header">
            <h1>Opiniões da comunidade</h1>
            <p>Interaja com as opiniões da comunidade selecionando um dos botões
                de opção.</p>
        </div>

        {% if comment %}
            {{ comment_detail(comment, user) }}
        {% else %}
            <div class="Comment">
                <h1>{{ _('Congratulations!') }}</h1>
                <p>{{ _("There are no comments left to vote :)") }}</p>
            </div>
        {% endif %}

        {# Post a new comment #}
        {% if can_comment %}
            {{ comment_form(csrf_input) }}
            <p>{{ _('You still have {n} available comments').format(n=remaining_comments) }}</p>
        {% elif user.id == None %}
            <p>{{ _('Please {login} to comment on this conversation').format(login=login_link)|safe }}</p>
        {% else %}
            <p>{% trans %}You have used all comments available in this conversation.{% endtrans %}</p>
        {% endif %}

        {# Opinion #}
        {% if conversation.opinion %}
            {{ opinion(conversation) }}
        {% endif %}
    </div>
{% endmacro %}
